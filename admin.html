<html>
<head>
<link rel="stylesheet" type="text/css" href="http://localhost:9614/stylesheet/bootstrap/bootstrap.min.css"/>
<style>
label.error {
	font-weight:normal;
	color:red;
	text-align:left;
	width:140px;
	padding-left:25px;
    background: transparent url(/images/cancel.png) no-repeat scroll left; 
}
</style>
</head>

<body>
	<div align='center'>
		<h3>Servers' Administrator</h3>
	
		<table id='server_list' class="table table-striped table-bordered table-hover" style="width:80%;">
		</table>
	</div>


	<div id="editModal" class="modal hide fade">
	  <div class="modal-header">
	    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
	    <h3>Modal header</h3>
	  </div>
	  	<div class="modal-body form-horizontal">
	    
		<div class="control-group">
			<label class="control-label" for="editIP">IP:</label>
			<div class="controls">
				<input type="text" id="editIP" class="input-large">
	    	</div>
		</div>
		
		<div class="control-group">
			<label class="control-label" for="editPort">Port:</label>
			<div class="controls">
				  <input type="text" id="editPort" class="input-large">
	    	</div>
		</div>

		<div class="control-group">
			<label class="control-label" for="editType">Type:</label>
			<div class="controls">
				  <select id="editType" class="input-large"><select>
	    	</div>
		</div>

	  </div>
	  <div class="modal-footer">
	    <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
	    <button class="btn btn-primary" onclick="save();">Save changes</a>
	  </div>
	</div>

<script src="http://localhost:9614/js/jquery.js"></script>
<script src="http://localhost:9614/js/bootstrap/bootstrap.min.js"></script>
<script type="text/javascript">
var server_list = [];
var type_list=["seed","region","school"];
var host;

jQuery(document).ready(function(){
    var dataString = 'action=content';

    jQuery.ajax
	({
		type: 'POST',
		url: 'http://localhost:9615/?'+dataString,
		dataType: 'json',
		success: function(data) {
			console.log('success');
			server_list = data;
			prepareContent();
		}
	});

	jQuery('#editType').empty();
	for (var i in type_list)
		jQuery('#editType').append('<option>' + type_list[i] + '</option>');
});

function edit(server) {	
	host = server.ip + ':' + server.port;
	
	jQuery('#editIP').val(server.ip);
	jQuery('#editPort').val(server.port);
	jQuery('#editType').val(server.type);

	jQuery('#editModal').modal('show');
}

function save() {
	var ip = jQuery('#editIP').val();
	var port = jQuery('#editPort').val();
	var type = jQuery('#editType').val();

	var dataString = 'action=save' +
					 '&host=' + host + 
					 '&ip=' + ip +
					 '&port=' + port +
					 '&type=' + type;

    jQuery.ajax
	({
		type: 'GET',
		url: 'http://localhost:9615/?'+dataString,
		dataType: 'json',
		success: function(data) {
			jQuery('#editModal').modal('hide');

			console.log('success');
			server_list = data;
			prepareContent();
		}
	});
}

function prepareContent(){
	jQuery('#server_list').empty();

	jQuery('#server_list').append('<th>IP</th>');
	jQuery('#server_list').append('<th>Port</th>');
	jQuery('#server_list').append('<th>Type</th>');
	jQuery('#server_list').append('<th>Edit</th>');

	for (var i in server_list) {
		console.log(server_list[i]);

		var server = server_list[i];

		jQuery('#server_list').append('<tr></tr>');
		jQuery('#server_list tr:last').append('<td>' + server.ip + '</td>');
		jQuery('#server_list tr:last').append('<td>' + server.port + '</td>');
		jQuery('#server_list tr:last').append('<td>' + server.type + '</td>');
		jQuery('#server_list tr:last').append('<td></td>');

		var edit_btn = "<button class='btn' onclick='edit("+JSON.stringify(server)+")'>"+
							"<i class='icon-pencil'></i>"+
				       "</button>";
		jQuery('#server_list tr:last td:last').append(edit_btn);
	}
}
</script>
</body>
</html>